<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="login-container">
    <h1>Login</h1>
    <form id="loginForm">
      <div class="form-group">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
      </div>
      <div class="form-group">
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required>
      </div>
      <button type="submit" class="login-btn">Login</button>
    </form>
    <div id="message" class="message"></div>
  </div>

  <!-- Load Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1.35.7/dist/umd/supabase.min.js"></script>


  <!-- Load your custom script -->
  <script src="script.js"></script>
</body>
</html>

<script type="module">
  import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

  const SUPABASE_URL = 'https://kvavhykbqpndnaajbdqv.supabase.co';
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt2YXZoeWticXBuZG5hYWpiZHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3MDUxODQsImV4cCI6MjA3NjI4MTE4NH0.JIuhvuvZMsUW_Re1lq0A1UexpTGznyquthb0Q987Dkc';

  const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

  const loginForm = document.getElementById('loginForm');
  const messageDiv = document.getElementById('message');

  loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();

    messageDiv.className = 'message';
    messageDiv.textContent = '';

    try {
      const { data, error } = await supabase
        .from('users')
        .select('*')
        .eq('email', email)
        .eq('password', password)
        .single();

      if (error || !data) {
        messageDiv.className = 'message error';
        messageDiv.textContent = '❌ Invalid email or password';
        return;
      }

      messageDiv.className = 'message success';
      messageDiv.textContent = '✓ Login successful! Welcome ' + data.name;

      setTimeout(() => {
        window.location.href = `dashboard.html?name=${encodeURIComponent(data.name)}`;
      }, 1500);
    } catch (err) {
      console.error('Error:', err);
      messageDiv.className = 'message error';
      messageDiv.textContent = '⚠ An error occurred. Please try again.';
    }
  });
</script>
